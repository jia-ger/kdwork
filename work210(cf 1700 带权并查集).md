https://codeforces.com/problemset/problem/1850/H

```c++
#include <bits/stdc++.h>
using namespace std;
#define int long long
#define endl '\n'

const int N = 2e5 + 10;
int f[N], dist[N];

// 修正的 find 函数
int find(int x) {
    if (f[x] != x) {
        int root = find(f[x]);  // 先找到根
        dist[x] += dist[f[x]];  // 更新权值
        f[x] = root;            // 路径压缩
    }
    return f[x];
}

// 修正的 join 函数
void join(int x, int y, int val) {
    int fx = find(x), fy = find(y);
    if (fx == fy) return;  // 已经在同一集合，不再合并
    f[fx] = fy;
    dist[fx] = val + dist[y] - dist[x];
}

void solve() {
    int n, m;
    cin >> n >> m;
    
    // 初始化
    for (int i = 1; i <= n; i++) {
        f[i] = i;
        dist[i] = 0;
    }
    
    bool ok = true;
    for (int i = 1; i <= m; i++) {
        int a, b, d;
        cin >> a >> b >> d;
        
        if (find(a) != find(b)) {
            join(a, b, d);
        } else {
            // 已经在同一集合，检查关系是否一致
            if (dist[a] - dist[b] != d) {
                ok = false;
                // 继续读完输入，但不处理
                for (int j = i + 1; j <= m; j++) {
                    cin >> a >> b >> d;  // 跳过剩余输入
                }
                break;
            }
        }
    }
    
    cout << (ok ? "YES" : "NO") << endl;
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    
    int T;
    cin >> T;
    while (T--) {
        solve();
    }
    return 0;
}
```
